{{#partial "title"}}
<title>{{title}}</title>
{{/partial}}
{{#partial "content"}}
<div class="ui main container">
    <div class="ui center aligned inverted segment">
        <h2 class="ui center aligned">
  			PUBLICIDADES
		</h2>
		
		<div class="ui clearing divider"></div>
        <button id="nuevoModal" class="circular purple fluid ui button">Nueva Publicidad</button>
        <div class="ui clearing divider"></div>
        
        <table id="publicidades" class="ui center aligned celled structured table">
            <thead>
	        	<tr>
    	            <th class="ascending" colspan="1">#</th>
        	        <th colspan="1">Sexo</th>
            	    <th colspan="1">Edad Min</th>
                	<th rowspan="1">Edad Max</th>
                	<th rowspan="1">Hr Min</th>
                	<th rowspan="1">Hr Max</th>
                	<th rowspan="1">Desc</th>
                	<th rowspan="1">Acciones</th>
            	</tr>
            </thead>
            <tbody>
            	{{#each publicidades}}
	            <tr>
    	            <td>{{this.id}}</td>
            	    <td>{{this.sexo}}</td>
            	    <td>{{this.edad_min}}</td>
            	    <td>{{this.edad_max}}</td>
            	    <td>{{this.horario_min}}</td>
            	    <td>{{this.horario_max}}</td>
            	    <td>{{this.descripcion}}</td>
            	    <td class="center aligned">
                        <button id="edit" class="ui edit icon button">
                            <i class="write icon"></i>
                        </button>
                        <button id="delete" class="ui delete icon button">
                            <i class="trash icon"></i>
                        </button>
                        <button id="delete" class="ui shuffle icon button">
                            <i class="shuffle icon"></i>
                        </button>
                        <button id="upload" class="ui circular icon button" type="file">
                            <i class="icon settings"></i>
                        </button>
                    </td>
    	        </tr>
    	        {{/each}}
            </tbody>
        </table>
        
        <img src="../img/marketing.png" id="idImagen" class="ui centered medium image">
        
    </div>
</div>
</div>

<div class="ui modal">
    <i class="close icon"></i>
        <div class="header">
            Nueva Publicidad
        </div>
        
        <div class="content">
	        <form class="ui form" method="POST" action="/publicidades">
				  
				  <div class="three fields">
				  	 <div class="required field">
						  <div class="ui selection dropdown">
							  <input type="hidden" name="sexo">
							  <i class="dropdown icon"></i>
							  <div class="default text">Genero</div>
							  <div class="menu">
							    <div class="item" data-value="M">Masculino</div>
							    <div class="item" data-value="F">Femenino</div>
							  </div>
						  </div>
					 </div>	  
				  </div>
				  
				  
				  <div class="two fields">
	                  
	                  <div class="required field">
				 	    					<div class="ui selection dropdown">
											  <input type="hidden" name="edad_min">
											  <i class="dropdown icon"></i>
											  <div class="default text">Edad Minima</div>
											  <div class="menu">
											    <div class="item" data-value="1">1</div>
											    <div class="item" data-value="10">10</div>
											    <div class="item" data-value="20">20</div>
											    <div class="item" data-value="30">30</div>
											    <div class="item" data-value="40">40</div>
											    <div class="item" data-value="50">50</div>
											    <div class="item" data-value="60">60</div>
											    <div class="item" data-value="70">70</div>
											    <div class="item" data-value="80">80</div>
											    <div class="item" data-value="90">90</div>
											  </div>
				  							</div>
				 	  </div>
				 	  
				 	  <div class="required field">
					    					<div class="ui selection dropdown">
											  <input type="hidden" name="edad_max">
											  <i class="dropdown icon"></i>
											  <div class="default text">Edad Maxima</div>
											  <div class="menu">
											    <div class="item" data-value="1">1</div>
											    <div class="item" data-value="20">20</div>
											    <div class="item" data-value="30">30</div>
											    <div class="item" data-value="40">40</div>
											    <div class="item" data-value="50">50</div>
											    <div class="item" data-value="60">60</div>
											    <div class="item" data-value="70">70</div>
											    <div class="item" data-value="80">80</div>
											    <div class="item" data-value="90">90</div>
											    <div class="item" data-value="100">100</div>
											  </div>
				 							 </div>
				 	  </div>
				 	  
                  </div>
                  
                  
                  
                  <div class="two fields">
	                  <div class="required field">
				    						<div class="ui selection dropdown">
											  <input type="hidden" name="horario_min">
											  <i class="dropdown icon"></i>
											  <div class="default text">Horario Minimo</div>
											  <div class="menu">
											    <div class="item" data-value="9">9</div>
											    <div class="item" data-value="12">12</div>
											    <div class="item" data-value="15">15</div>
											    <div class="item" data-value="18">18</div>
											    <div class="item" data-value="21">21</div>
											  </div>
				 							 </div>
				  	  </div>
				      <div class="required field">
				    						<div class="ui selection dropdown">
											  <input type="hidden" name="horario_max">
											  <i class="dropdown icon"></i>
											  <div class="default text">Horario Maximo</div>
											  <div class="menu">
											    <div class="item" data-value="12">12</div>
											    <div class="item" data-value="15">15</div>
											    <div class="item" data-value="18">18</div>
											    <div class="item" data-value="21">21</div>
											    <div class="item" data-value="24">24</div>
											  </div>
				 							 </div>
				  	  </div>
                  </div>
				 
				  <div>
            	      <input type="file" id ="fileUpload" class="circular red fluid ui button" value="Seleccionar" onchange="funcionNombre(this.value)">
                  </div>
				 
				  <div class="field">
				  		<label>Descripcion</label>
				    	<input type="text" id="pathImagen" name="descripcion" placeholder="Path..." required="true" readonly="true">
				  </div>
				  <div class="field">
		            	<input type="submit" class="circular purple fluid ui button" value="Aceptar">
		          </div> 
			</form>
		</div>
</div>

<script>
	
	function funcionNombre(fic) {
  		fic = fic.split('\\');
  		var nombreArchivo = (fic[fic.length-1]);
  		$('.ui.modal .content').find('input[name=descripcion]').val(nombreArchivo);
	}	
	
	$(".ui.shuffle.icon.button").click(function(){
    	var nombreArchivo = $(this).parents("tr").find("td").eq(6).text();
    	var ruta = "../img/";
    	alert(nombreArchivo);
    	var final = ruta + nombreArchivo;
    	$('#idImagen').attr('src', final);
    });

	$("#nuevoModal").click(function(){
        $('.ui.modal').modal({
            onShow    : function(){
                $('.ui.modal .header').text("Nueva Publicidad");
                $('.ui.modal .content').find('input[name=nombre]').val("");
                $('.ui.modal .content').find('input[name=posicion]').val("");
                $('.ui.modal .content').find('input[name=edad]').val("");
            }
        }).modal('show');
    }); 

	$(".ui.delete.icon.button").click(function(){
        var pub_id = $(this).parent().parent().find("td:first").text();
       
       $.ajax({
            url : "/publicidades/" + pub_id,
            method : "DELETE",
            success : function(response){
                $('#publicidades tr:eq('+pub_id+')').remove();
            }
        }) 
    });

</script>

{{/partial}}
{{> layout.hbs}}